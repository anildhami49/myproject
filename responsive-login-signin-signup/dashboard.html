<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        .dashboard-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 2rem;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        .dashboard-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #4F3C75;
        }
        .dashboard-message {
            font-size: 1.1rem;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-title">Welcome to Your Dashboard!</div>
        <div class="dashboard-message">
            You have successfully logged in.<br>
            This is your dashboard page. You can customize this page as needed.
        </div>
    </div>
</body>
</html> -->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BikeRide Booking</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for aesthetic touch -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Apply Inter font and set base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Very light cool background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Custom focus state - Amber color scheme */
        .input-focus:focus {
            border-color: #f59e0b; /* Amber-500 */
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.5);
            outline: none;
        }

        /* Hide the default date/time picker icons on webkit/firefox */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
    </style>
</head>
<script>
// (Removed duplicate/stray script block)
</script>
<body>

    <!-- Main Booking Container -->
    <div class="w-full max-w-lg bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-100">
        
        <!-- Header Section -->
        <header class="text-center mb-8">
            <div class="flex items-center justify-center text-amber-500 mb-2">
                <!-- Lucide Bike Icon (representing the service) -->
                <i data-lucide="bike" class="w-10 h-10"></i>
            </div>
            <h1 class="text-3xl font-extrabold text-gray-900">Book Your ZipRide Bike Taxi</h1>
            <p class="text-gray-500 mt-1">Get fast rides at low fares.</p>
        </header>

        <!-- Booking Form -->
    <form id="bookingForm" class="space-y-6">

            <!-- Location Inputs Block (Visually Grouped) -->
            <div class="bg-gray-50 p-4 rounded-xl shadow-inner border border-gray-200 relative">
                
                <!-- Vertical connection line -->
                <div class="absolute left-7 top-14 bottom-14 w-0.5 bg-gray-300"></div>

                <!-- 1. Pickup Location -->
                <div class="relative mb-4">
                    <label for="pickupLocation" class="block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Pickup</label>
                    <div class="flex items-center relative">
                        <!-- Green Dot for Pickup -->
                        <div class="absolute left-0 w-3 h-3 bg-green-500 rounded-full z-10 -ml-4 ring-4 ring-gray-50"></div>
                        
                        <input type="text" id="pickupLocation" name="pickupLocation" placeholder="Current location or address"
                            class="input-focus w-full pl-4 pr-4 py-3 border border-gray-300 rounded-lg text-gray-800 transition duration-150 ease-in-out shadow-sm text-base"
                            required>
                    </div>
                </div>

                <!-- 2. Drop Location -->
                <div class="relative">
                    <label for="dropLocation" class="block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Drop-off</label>
                    <div class="flex items-center relative">
                        <!-- Red Square for Drop-off -->
                        <div class="absolute left-0 w-3 h-3 bg-red-500 rounded-sm z-10 -ml-4 ring-4 ring-gray-50 transform rotate-45"></div>

                        <input type="text" id="dropLocation" name="dropLocation" placeholder="Where do you want to go?"
                            class="input-focus w-full pl-4 pr-4 py-3 border border-gray-300 rounded-lg text-gray-800 transition duration-150 ease-in-out shadow-sm text-base"
                            required>
                    </div>
                </div>
            </div>

            <!-- Date and Time Inputs (side-by-side) -->
            <div class="grid grid-cols-2 gap-4">
                
                <!-- Date Input -->
                <div class="relative">
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <div class="flex items-center relative">
                        <i data-lucide="calendar" class="absolute left-3 text-gray-400 w-5 h-5 pointer-events-none"></i>
                        <input type="date" id="date" name="date"
                            class="input-focus w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg text-gray-800 transition duration-150 ease-in-out shadow-sm appearance-none"
                            required>
                    </div>
                </div>

                <!-- Time Input -->
                <div class="relative">
                    <label for="time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                    <div class="flex items-center relative">
                        <i data-lucide="clock" class="absolute left-3 text-gray-400 w-5 h-5 pointer-events-none"></i>
                        <input type="time" id="time" name="time"
                            class="input-focus w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg text-gray-800 transition duration-150 ease-in-out shadow-sm appearance-none"
                            required>
                    </div>
                </div>
            </div>

            <!-- Hidden fields for demo (replace with real user data in production) -->
            <input type="hidden" id="email" value="demo@example.com">
            <input type="hidden" id="username" value="demoUser">

            <!-- Booking Message Box (for feedback) -->
            <div id="messageBox" class="hidden p-4 rounded-lg text-sm transition-all duration-300"></div>
            
            <!-- AI Insights Button -->
            <button type="button" onclick="getTripInsights()" id="insightsButton"
                class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg shadow-xl transition duration-200 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50 flex items-center justify-center space-x-2">
                <i data-lucide="sparkles" class="w-5 h-5"></i>
                <span>âœ¨ Get Trip Insights & Safety Tips</span>
            </button>
            
            <!-- AI Insights Display Container -->
            <div id="insightsContainer" class="hidden mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200 text-gray-700">
                <p id="insightsContent" class="mb-2"></p>
                <div id="insightsLoading" class="hidden text-center text-sm text-blue-500 py-2">
                    <i data-lucide="loader-2" class="w-5 h-5 inline animate-spin mr-2"></i>
                    Generating insights...
                </div>
            </div>

            <!-- Submit Button (Amber color) -->
            <button type="button"
                class="w-full bg-amber-500 hover:bg-amber-600 text-gray-900 font-bold py-3 rounded-lg shadow-xl transition duration-200 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-amber-400 focus:ring-opacity-50">
                FIND YOUR RIDE
            </button>
            <button type="submit"
                class="w-full mt-3 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg shadow-xl transition duration-200 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-50">
                Submit Booking
            </button>
        </form>
      <!-- Removed duplicate form -->

        <!-- Footer Note -->
        <p class="text-xs text-center text-gray-400 mt-6">
             | Terms and condition apply Before click any button please Read instruction documents.|
        </p>
    </div>

    <!-- JavaScript for form handling and displaying feedback -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // --- Gemini API Integration Setup ---
        const API_MODEL = 'gemini-2.5-flash-preview-05-20';
        const apiKey = ""; // Leave as-is

        /**
         * Retries a fetch request with exponential backoff.
         */
        async function retryFetch(url, options, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429) {
                        throw new Error('Rate limit exceeded');
                    }
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    console.warn(`Fetch attempt ${i + 1} failed: ${error.message}`);
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        /**
         * Calls Gemini API to generate trip insights and safety tips based on locations.
         */
        async function getTripInsights() {
            const pickup = document.getElementById('pickupLocation').value.trim();
            const drop = document.getElementById('dropLocation').value.trim();
            const insightsContainer = document.getElementById('insightsContainer');
            const insightsContent = document.getElementById('insightsContent');
            const insightsLoading = document.getElementById('insightsLoading');
            
            // Hide previous messages
            document.getElementById('messageBox').classList.add('hidden');

            if (!pickup || !drop) {
                insightsContainer.className = 'mt-4 p-4 rounded-xl border border-red-200 bg-red-50 text-red-700';
                insightsContent.innerHTML = 'Please enter both a **Pickup** and **Drop-off** location first to get insights.';
                insightsContainer.classList.remove('hidden');
                lucide.createIcons();
                return;
            }

            insightsContainer.classList.remove('hidden');
            insightsContent.textContent = '';
            insightsLoading.classList.remove('hidden');
            insightsContainer.className = 'mt-4 p-4 rounded-xl border border-blue-200 bg-blue-50 text-gray-700';

            const systemPrompt = "You are a helpful ride safety assistant. Generate a single paragraph of text offering a brief summary of the potential journey and 2-3 general safety tips relevant to the trip type (e.g., city, busy traffic, night time). Focus on safety and awareness. The response must be polite and concise.";
            
            const userQuery = `The user is planning a bike ride from "${pickup}" to "${drop}". Provide a quick trip summary and safety tips.`;
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // Use Google Search for grounded safety tips/context
                tools: [{ "google_search": {} }], 
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await retryFetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let text = candidate.content.parts[0].text;
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Format output
                    let finalHtml = `
                        <h3 class="font-bold text-base mb-2 text-blue-700 flex items-center">
                            <i data-lucide="shield-check" class="w-5 h-5 mr-2"></i>
                            Trip Insights
                        </h3>
                        <p class="text-sm">${text}</p>
                    `;

                    if (sources.length > 0) {
                        finalHtml += `<p class="mt-3 text-xs text-gray-500 italic">Grounded by:</p>`;
                        sources.slice(0, 1).forEach((source) => { // Limit to 1 source for brevity
                            finalHtml += `<p class="text-xs text-blue-500 truncate"><a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="hover:underline">${source.title || 'Source'}</a></p>`;
                        });
                    }
                    
                    insightsContainer.className = 'mt-4 p-4 rounded-xl border border-blue-200 bg-blue-50 text-gray-700';
                    insightsContent.innerHTML = finalHtml;
                    
                } else {
                    insightsContainer.className = 'mt-4 p-4 rounded-xl border border-red-200 bg-red-50 text-red-700';
                    insightsContent.innerHTML = 'Error generating insights. Please try again.';
                }

            } catch (error) {
                console.error('Gemini API call failed:', error);
                insightsContainer.className = 'mt-4 p-4 rounded-xl border border-red-200 bg-red-50 text-red-700';
                insightsContent.innerHTML = 'An unexpected error occurred while contacting the service.';
            } finally {
                insightsLoading.classList.add('hidden');
                lucide.createIcons(); // Re-initialize icons for the new content
            }
        }

        // Function to handle form submission and send to backend
        document.getElementById('bookingForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const pickup = document.getElementById('pickupLocation').value;
            const drop = document.getElementById('dropLocation').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const email = document.getElementById('email').value;
            const username = document.getElementById('username').value;

            const messageBox = document.getElementById('messageBox');
            messageBox.classList.remove('hidden');
            document.getElementById('insightsContainer').classList.add('hidden');

            try {
                const response = await fetch('http://localhost:5000/book', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, pickup, drop, date, time, email })
                });
                const result = await response.json();
                if (response.ok) {
                    messageBox.className = 'p-4 rounded-lg text-sm transition-all duration-300 bg-green-100 text-green-800 border border-green-200';
                    messageBox.innerHTML = `<div class="font-bold text-lg flex items-center mb-1"><i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>Booking Confirmed!</div><p>${result.message}</p>`;
                } else {
                    messageBox.className = 'p-4 rounded-lg text-sm transition-all duration-300 bg-red-100 text-red-800 border border-red-200';
                    messageBox.innerHTML = `<div class="font-bold text-lg flex items-center mb-1"><i data-lucide="alert-circle" class="w-5 h-5 mr-2"></i>Booking Failed</div><p>${result.message}</p>`;
                }
            } catch (error) {
                messageBox.className = 'p-4 rounded-lg text-sm transition-all duration-300 bg-red-100 text-red-800 border border-red-200';
                messageBox.innerHTML = `<div class="font-bold text-lg flex items-center mb-1"><i data-lucide="alert-circle" class="w-5 h-5 mr-2"></i>Booking Failed</div><p>Could not connect to server.</p>`;
            }
            lucide.createIcons();
            messageBox.scrollIntoView({ behavior: 'smooth' });
        });
    </script>

</body>
</html>
